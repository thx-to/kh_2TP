-- STORE 테이블 생성
CREATE TABLE STORE_TB(
	STORE_NO INTEGER NOT NULL PRIMARY KEY, 						/* 매장번호 */
	STORE_NAME VARCHAR2(100) NOT NULL, 							/* 매장명 */
	STORE_PHONE VARCHAR2(15) NOT NULL, 							/* 매장 연락처 */
	STORE_ADDR VARCHAR2(100) NOT NULL, 							/* 매장 주소 */
	STORE_MAP VARCHAR2(50) NOT NULL, 							/* 매장 위치(위도, 경도) */
	BRAND_NAME VARCHAR2(20) NOT NULL, 							/* 브랜드명 */
    BRAND_OPEN DATE NOT NULL, 									/* 영업 시작 시간 (날짜는 임의 값) */
    BRAND_CLOSE DATE NOT NULL, 									/* 영업 종료 시간 (날짜는 임의 값) */
	-- UNIQUE 제약조건
	CONSTRAINT UNIQUE_STORE1 UNIQUE (STORE_NAME, STORE_PHONE, BRAND_NAME), 	/* RESERVATION */
	--	FK 제약조건
	CONSTRAINT FK_STORE_BRAND
		FOREIGN KEY (BRAND_NAME, BRAND_OPEN, BRAND_CLOSE)
		REFERENCES BRAND_TB (BRAND_NAME, BRAND_OPEN, BRAND_CLOSE)
		ON DELETE CASCADE
);


-- STORE_NO 시퀀스 생성
CREATE SEQUENCE STORE_NO_SEQ
INCREMENT BY 1
START WITH 1
NOCYCLE
NOCACHE;


-- STORE 더미 데이터 생성
INSERT INTO STORE_TB (STORE_NO, STORE_NAME, STORE_PHONE, STORE_ADDR, STORE_MAP, BRAND_NAME, BRAND_OPEN, BRAND_CLOSE)
SELECT STORE_NO_SEQ.NEXTVAL, '백종원의 빽보이피자 신논현역점', '1668-3791', '서울 서초구 사평대로55길 18 1층', '37.504821583727015, 127.02274378520693', '빽보이피자',
B.BRAND_OPEN, B.BRAND_CLOSE FROM BRAND_TB B WHERE B.BRAND_NAME = '빽보이피자';

INSERT INTO STORE_TB (STORE_NO, STORE_NAME, STORE_PHONE, STORE_ADDR, STORE_MAP, BRAND_NAME, BRAND_OPEN, BRAND_CLOSE)
SELECT STORE_NO_SEQ.NEXTVAL, '백종원의 빽보이피자 서초점', '070-8840-3804', '서울 서초구 서초대로 280 1층', '37.492990664525664, 127.01233127061306', '빽보이피자',
B.BRAND_OPEN, B.BRAND_CLOSE FROM BRAND_TB B WHERE B.BRAND_NAME = '빽보이피자';

INSERT INTO STORE_TB (STORE_NO, STORE_NAME, STORE_PHONE, STORE_ADDR, STORE_MAP, BRAND_NAME, BRAND_OPEN, BRAND_CLOSE)
SELECT STORE_NO_SEQ.NEXTVAL, '백종원의 빽보이피자 강남청담점', '02-3446-7776', '서울 강남구 삼성로145길 14 103호', '37.52250555013786, 127.04721495360617', '빽보이피자',
B.BRAND_OPEN, B.BRAND_CLOSE FROM BRAND_TB B WHERE B.BRAND_NAME = '빽보이피자';

INSERT INTO STORE_TB (STORE_NO, STORE_NAME, STORE_PHONE, STORE_ADDR, STORE_MAP, BRAND_NAME, BRAND_OPEN, BRAND_CLOSE)
SELECT STORE_NO_SEQ.NEXTVAL, '백종원의 빽보이피자 건대점', '1668-1089', '서울 광진구 능동로13길 54 1층', '37.54425350218965, 127.06985146298014', '빽보이피자',
B.BRAND_OPEN, B.BRAND_CLOSE FROM BRAND_TB B WHERE B.BRAND_NAME = '빽보이피자';

INSERT INTO STORE_TB (STORE_NO, STORE_NAME, STORE_PHONE, STORE_ADDR, STORE_MAP, BRAND_NAME, BRAND_OPEN, BRAND_CLOSE)
SELECT STORE_NO_SEQ.NEXTVAL, '백종원의 빽보이피자 송파헬리오시티점', '1668-5490', '서울 송파구 가락로12길 4 1층', '37.499778661506284, 127.10513344077887', '빽보이피자',
B.BRAND_OPEN, B.BRAND_CLOSE FROM BRAND_TB B WHERE B.BRAND_NAME = '빽보이피자';

INSERT INTO STORE_TB (STORE_NO, STORE_NAME, STORE_PHONE, STORE_ADDR, STORE_MAP, BRAND_NAME, BRAND_OPEN, BRAND_CLOSE)
SELECT STORE_NO_SEQ.NEXTVAL, '역전우동0410 역삼테헤란로점', '02-553-2111', '서울 강남구 테헤란로10길 25 104호', '37.497588576835305, 127.03305220574101', '역전우동',
B.BRAND_OPEN, B.BRAND_CLOSE FROM BRAND_TB B WHERE B.BRAND_NAME = '역전우동';


-- STORE 테스트용 쿼리문
SELECT * FROM STORE_TB;							/* 전체 데이터 조회 */

DELETE FROM STORE_TB WHERE BRAND_NAME = ''; 	/* 브랜드명 단위로 데이터 삭제 */

DROP SEQUENCE STORE_NO_SEQ;						/* STORE_NO 시퀀스 삭제 */

DROP TABLE STORE_TB;							/* STORE 테이블 삭제 */

COMMIT;
